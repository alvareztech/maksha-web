<form>
  <md-toolbar>
    <button md-button (click)="returnLabs()">LABS</button>
    <div *ngIf="isLabSelected">
      <a md-button href="https://alvarez.tech/labs/{{ currentLab?.$key }}"
         target="_blank">/{{currentLab?.$key}}</a>
      <a md-button
         href="https://console.firebase.google.com/project/maksha-41f4f/database/data/labs/{{ currentLab?.$key }}"
         target="_blank">
        <md-icon>cloud</md-icon>
      </a>
    </div>
    <span class="dottech-spacer"></span>
    <button md-mini-fab (click)="newLab()" *ngIf="!isLabSelected">
      <md-icon>add</md-icon>
    </button>
    <button md-mini-fab color="accent" (click)="saveLab()" *ngIf="isLabSelected && isNewLab">
      <md-icon>save</md-icon>
    </button>
    <button md-mini-fab color="accent" (click)="updateLab()" *ngIf="isLabSelected && !isNewLab">
      <md-icon>update</md-icon>
    </button>
  </md-toolbar>

  <div *ngIf="!isLabSelected" class="row">
    <md-spinner *ngIf="!(labs | async)"></md-spinner>
    <md-nav-list>
      <md-list-item *ngFor="let lab of labs | async" (click)="goLab(lab)">
        <md-icon md-list-icon *ngIf="!lab.published">build</md-icon>
        <md-icon md-list-icon *ngIf="lab.published" color="accent">check_circle</md-icon>
        <h4>{{ lab.title }}</h4>
        <p>&nbsp;{{ lab.updated | date }}</p>
      </md-list-item>
    </md-nav-list>
  </div>

  <div class="row" *ngIf="isLabSelected">

    <div class="col-12 col-sm-4">
      <md-card>

        <md-input-container>
          <input mdInput placeholder="Title" [(ngModel)]="currentLab.title" name="Title">
        </md-input-container>

        <md-input-container *ngIf="isNewLab">
          <input mdInput placeholder="Identifier" [(ngModel)]="currentLab.$key" name="Identifier">
        </md-input-container>

        <md-input-container>
          <input mdInput id="stepTitle"
                 placeholder="Step title" [(ngModel)]="currentStep.title" name="Step Title">
        </md-input-container>

        <p>
          <md-select id="techLab" [(ngModel)]="currentLab.technology" name="Technology" required
                     ngDefaultControl placeholder="Technology">
            <md-option *ngFor="let tech of technologyService.getTechnologies()" [value]="tech.id">
              {{ tech.name }}
            </md-option>
          </md-select>
        </p>

        <p>
          <md-select id="levelLab" name="Level" [(ngModel)]="currentLab.level" required ngDefaultControl
                     placeholder="Level">
            <md-option *ngFor="let level of technologyService.getLevels()" [value]="level.id">
              {{ level.name }}
            </md-option>
          </md-select>
        </p>
        <p>
          <md-button-toggle-group #group="mdButtonToggleGroup">
            <md-button-toggle *ngFor="let x of currentLab.steps; let i = index;" (click)="setStep(i)">
              {{ i }}
            </md-button-toggle>
          </md-button-toggle-group>
        </p>

        <button md-button (click)="newStep()">New step</button>

        <md-checkbox [(ngModel)]="currentLab.published" name="Published" ngDefaultControl>Published
        </md-checkbox>

      </md-card>
    </div>

    <div class="col-12 col-sm-8">
      <md-card>

        <md-input-container>
          <textarea mdInput rows="25" [(ngModel)]="currentStep.content" name="Content"></textarea>
        </md-input-container>

      </md-card>
    </div>

  </div>
</form>
